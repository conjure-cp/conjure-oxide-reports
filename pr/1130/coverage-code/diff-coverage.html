<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
        <title>Diff Coverage</title>
        <style>
            .src-snippet { margin-top: 2em; }
            .src-name { font-weight: bold; }
            .snippets {
                border-top: 1px solid #bdbdbd;
                border-bottom: 1px solid #bdbdbd;
            }
            pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffcccc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #F00 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #04D } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #00F; font-weight: bold } /* Name.Class */
.no { color: #800 } /* Name.Constant */
.nd { color: #A2F } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #00F } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #00F; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #A2F; font-weight: bold } /* Operator.Word */
.w { color: #BBB } /* Text.Whitespace */
.mb { color: #666 } /* Literal.Number.Bin */
.mf { color: #666 } /* Literal.Number.Float */
.mh { color: #666 } /* Literal.Number.Hex */
.mi { color: #666 } /* Literal.Number.Integer */
.mo { color: #666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #00F } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666 } /* Literal.Number.Integer.Long */
        </style>
    </head>
    <body>
        <h1>Diff Coverage</h1>
        <p>Diff: upstream/main...HEAD, staged and unstaged changes</p>
        <ul>
            <li><b>Total</b>: 222 lines</li>
            <li><b>Missing</b>: 72 lines</li>
            <li><b>Coverage</b>: 67%</li>
        </ul>
        <table border="1">
            <tr>
                <th>Source File</th>
                <th>Diff Coverage (%)</th>
                <th>Missing Lines</th>
            </tr>
            <tr>
                <td>crates/conjure-cp-cli/src/pretty.rs</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>crates/conjure-cp-cli/src/utils/testing.rs</td>
                <td>80.0%</td>
                <td>107,144,174,258,266,270</td>
            </tr>
            <tr>
                <td>crates/conjure-cp-core/src/solver/mod.rs</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>crates/conjure-cp-essence-parser/src/parser/parse_model.rs</td>
                <td>75.0%</td>
                <td>24</td>
            </tr>
            <tr>
                <td>tests-integration/tests/integration_tests.rs</td>
                <td>61.2%</td>
                <td>53,91,103,115,127,142,144,146,149,157,218,227,230,241,247-248,366,369,372-378,381,383-396,399,430,458,477,479,481-482,492,494-495,497-498</td>
            </tr>
            <tr>
                <td>tests-integration/tests/roundtrip_tests.rs</td>
                <td>72.3%</td>
                <td>108,110,113,115-116,119-120,124,146-147,155,185-186</td>
            </tr>
        </table>
        <div class="src-snippet">
            <div class="src-name">crates/conjure-cp-cli/src/utils/testing.rs</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-cli/src/utils/testing.rs-103" name="crates/conjure-cp-cli/src/utils/testing.rs-103"></a><span class="p">}</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-104" name="crates/conjure-cp-cli/src/utils/testing.rs-104"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-105" name="crates/conjure-cp-cli/src/utils/testing.rs-105"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">serialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">ConjureModel</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">JsonError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-106" name="crates/conjure-cp-cli/src/utils/testing.rs-106"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">serde_model</span><span class="p">:</span><span class="w"> </span><span class="nc">SerdeModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">into</span><span class="p">();</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-107" name="crates/conjure-cp-cli/src/utils/testing.rs-107"></a><span class="hll"><span class="w">    </span>
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-108" name="crates/conjure-cp-cli/src/utils/testing.rs-108"></a><span class="w">    </span><span class="c1">// Convert to JSON with stable IDs</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-109" name="crates/conjure-cp-cli/src/utils/testing.rs-109"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">json_with_stable_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_to_json_with_stable_ids</span><span class="p">(</span><span class="o">&amp;</span><span class="n">serde_model</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-110" name="crates/conjure-cp-cli/src/utils/testing.rs-110"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-111" name="crates/conjure-cp-cli/src/utils/testing.rs-111"></a><span class="w">    </span><span class="c1">// Sort JSON object keys for consistent output</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-cli/src/utils/testing.rs-140" name="crates/conjure-cp-cli/src/utils/testing.rs-140"></a><span class="w">    </span><span class="n">solver</span><span class="p">:</span><span class="w"> </span><span class="nc">SolverFamily</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-141" name="crates/conjure-cp-cli/src/utils/testing.rs-141"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-142" name="crates/conjure-cp-cli/src/utils/testing.rs-142"></a><span class="w">    </span><span class="cp">#[allow(clippy::unwrap_used)]</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-143" name="crates/conjure-cp-cli/src/utils/testing.rs-143"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">as_str</span><span class="p">();</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-144" name="crates/conjure-cp-cli/src/utils/testing.rs-144"></a><span class="hll">
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-145" name="crates/conjure-cp-cli/src/utils/testing.rs-145"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">clone</span><span class="p">();</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-146" name="crates/conjure-cp-cli/src/utils/testing.rs-146"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">generated_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort_json_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">serde_json</span><span class="p">::</span><span class="n">to_value</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-147" name="crates/conjure-cp-cli/src/utils/testing.rs-147"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-148" name="crates/conjure-cp-cli/src/utils/testing.rs-148"></a><span class="w">    </span><span class="c1">// serialise to string</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-cli/src/utils/testing.rs-170" name="crates/conjure-cp-cli/src/utils/testing.rs-170"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">ConjureModel</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-171" name="crates/conjure-cp-cli/src/utils/testing.rs-171"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">map_or</span><span class="p">(</span><span class="s">&quot;agnostic&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">as_str</span><span class="p">());</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-172" name="crates/conjure-cp-cli/src/utils/testing.rs-172"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-173" name="crates/conjure-cp-cli/src/utils/testing.rs-173"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{marker}-{test_name}.{prefix}-{test_stage}.serialised.json&quot;</span><span class="p">);</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-174" name="crates/conjure-cp-cli/src/utils/testing.rs-174"></a><span class="hll">
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-175" name="crates/conjure-cp-cli/src/utils/testing.rs-175"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_json_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">read_to_string</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-176" name="crates/conjure-cp-cli/src/utils/testing.rs-176"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_model</span><span class="p">:</span><span class="w"> </span><span class="nc">SerdeModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">expected_json_str</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-177" name="crates/conjure-cp-cli/src/utils/testing.rs-177"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-178" name="crates/conjure-cp-cli/src/utils/testing.rs-178"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">expected_model</span><span class="p">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">clone</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">())</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-cli/src/utils/testing.rs-254" name="crates/conjure-cp-cli/src/utils/testing.rs-254"></a><span class="w">    </span><span class="n">test_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-255" name="crates/conjure-cp-cli/src/utils/testing.rs-255"></a><span class="w">    </span><span class="n">prefix</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-256" name="crates/conjure-cp-cli/src/utils/testing.rs-256"></a><span class="w">    </span><span class="n">solver</span><span class="p">:</span><span class="w"> </span><span class="nc">SolverFamily</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-257" name="crates/conjure-cp-cli/src/utils/testing.rs-257"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-258" name="crates/conjure-cp-cli/src/utils/testing.rs-258"></a><span class="hll"><span class="w">    </span><span class="c1">// let solver_name = solver.as_str();</span>
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-259" name="crates/conjure-cp-cli/src/utils/testing.rs-259"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-260" name="crates/conjure-cp-cli/src/utils/testing.rs-260"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">solver</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-261" name="crates/conjure-cp-cli/src/utils/testing.rs-261"></a><span class="w">        </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Sat</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;sat&quot;</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-262" name="crates/conjure-cp-cli/src/utils/testing.rs-262"></a><span class="w">        </span><span class="cp">#[cfg(feature = </span><span class="s">&quot;smt&quot;</span><span class="cp">)]</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-cli/src/utils/testing.rs-262" name="crates/conjure-cp-cli/src/utils/testing.rs-262"></a><span class="w">        </span><span class="cp">#[cfg(feature = </span><span class="s">&quot;smt&quot;</span><span class="cp">)]</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-263" name="crates/conjure-cp-cli/src/utils/testing.rs-263"></a><span class="w">        </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Smt</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;smt&quot;</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-264" name="crates/conjure-cp-cli/src/utils/testing.rs-264"></a><span class="w">        </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Minion</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;minion&quot;</span><span class="p">,</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-265" name="crates/conjure-cp-cli/src/utils/testing.rs-265"></a><span class="w">    </span><span class="p">};</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-266" name="crates/conjure-cp-cli/src/utils/testing.rs-266"></a><span class="hll"><span class="w">    </span><span class="c1">// let filename =</span>
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-267" name="crates/conjure-cp-cli/src/utils/testing.rs-267"></a><span class="w">    </span><span class="c1">//     format!(&quot;{path}/{solver_name}-{test_name}.{prefix}-{solver_name}.solutions.json&quot;);</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-268" name="crates/conjure-cp-cli/src/utils/testing.rs-268"></a><span class="w">    </span><span class="c1">// let _expected_json_str = std::fs::read_to_string(filename)?;</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-269" name="crates/conjure-cp-cli/src/utils/testing.rs-269"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_json_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_with_path</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-270" name="crates/conjure-cp-cli/src/utils/testing.rs-270"></a><span class="hll"><span class="w">        </span><span class="s">&quot;{path}/{solver_name}-{test_name}.{prefix}-{solver_name}.solutions.json&quot;</span>
</span><a id="crates/conjure-cp-cli/src/utils/testing.rs-271" name="crates/conjure-cp-cli/src/utils/testing.rs-271"></a><span class="w">    </span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-272" name="crates/conjure-cp-cli/src/utils/testing.rs-272"></a>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-273" name="crates/conjure-cp-cli/src/utils/testing.rs-273"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_solutions</span><span class="p">:</span><span class="w"> </span><span class="nc">JsonValue</span><span class="w"> </span><span class="o">=</span>
<a id="crates/conjure-cp-cli/src/utils/testing.rs-274" name="crates/conjure-cp-cli/src/utils/testing.rs-274"></a><span class="w">        </span><span class="n">sort_json_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">expected_json_str</span><span class="p">)</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">crates/conjure-cp-essence-parser/src/parser/parse_model.rs</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-20" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-20"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Model</span><span class="p">,</span><span class="w"> </span><span class="n">EssenceParseError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-21" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-21"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-22" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-22"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binding</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;poisoned RwLock&quot;</span><span class="p">);</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-23" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-23"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:#?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">guard</span><span class="p">);</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-24" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-24"></a><span class="hll">
</span><a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-25" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-25"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">source_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">::</span><span class="n">read_to_string</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-26" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-26"></a><span class="w">        </span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(</span><span class="s">&quot;Failed to read the source code file {path}&quot;</span><span class="p">));</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-27" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-27"></a><span class="w">    </span><span class="n">parse_essence_with_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">source_code</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<a id="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-28" name="crates/conjure-cp-essence-parser/src/parser/parse_model.rs-28"></a><span class="p">}</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">tests-integration/tests/integration_tests.rs</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-49" name="tests-integration/tests/integration_tests.rs-49"></a><span class="k">use</span><span class="w"> </span><span class="n">pretty_assertions</span><span class="p">::</span><span class="n">assert_eq</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-50" name="tests-integration/tests/integration_tests.rs-50"></a><span class="k">use</span><span class="w"> </span><span class="n">tests_integration</span><span class="p">::</span><span class="n">TestConfig</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-51" name="tests-integration/tests/integration_tests.rs-51"></a>
<a id="tests-integration/tests/integration_tests.rs-52" name="tests-integration/tests/integration_tests.rs-52"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-53" name="tests-integration/tests/integration_tests.rs-53"></a><span class="hll"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_scoped_subscriber</span><span class="p">(</span><span class="s">&quot;./logs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test_log&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none_solver&quot;</span><span class="p">);</span>
</span><a id="tests-integration/tests/integration_tests.rs-54" name="tests-integration/tests/integration_tests.rs-54"></a>
<a id="tests-integration/tests/integration_tests.rs-55" name="tests-integration/tests/integration_tests.rs-55"></a><span class="w">    </span><span class="c1">// creating a span and log a message</span>
<a id="tests-integration/tests/integration_tests.rs-56" name="tests-integration/tests/integration_tests.rs-56"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">test_span</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">span</span><span class="o">!</span><span class="p">(</span><span class="n">Level</span><span class="p">::</span><span class="n">TRACE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test_span&quot;</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-57" name="tests-integration/tests/integration_tests.rs-57"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_enter</span><span class="p">:</span><span class="w"> </span><span class="nc">span</span><span class="p">::</span><span class="n">Entered</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_span</span><span class="p">.</span><span class="n">enter</span><span class="p">();</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-87" name="tests-integration/tests/integration_tests.rs-87"></a><span class="w">            </span><span class="n">toml</span><span class="p">::</span><span class="n">from_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config_contents</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span>
<a id="tests-integration/tests/integration_tests.rs-88" name="tests-integration/tests/integration_tests.rs-88"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-89" name="tests-integration/tests/integration_tests.rs-89"></a><span class="w">            </span><span class="nb">Default</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<a id="tests-integration/tests/integration_tests.rs-90" name="tests-integration/tests/integration_tests.rs-90"></a><span class="w">        </span><span class="p">};</span>
<a id="tests-integration/tests/integration_tests.rs-91" name="tests-integration/tests/integration_tests.rs-91"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-92" name="tests-integration/tests/integration_tests.rs-92"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_config</span><span class="p">.</span><span class="n">merge_env</span><span class="p">();</span>
<a id="tests-integration/tests/integration_tests.rs-93" name="tests-integration/tests/integration_tests.rs-93"></a>
<a id="tests-integration/tests/integration_tests.rs-94" name="tests-integration/tests/integration_tests.rs-94"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">solve_with_minion</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-95" name="tests-integration/tests/integration_tests.rs-95"></a><span class="w">        </span><span class="n">solver_specific_integration_test</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-99" name="tests-integration/tests/integration_tests.rs-99"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">config</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-100" name="tests-integration/tests/integration_tests.rs-100"></a><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Minion</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-101" name="tests-integration/tests/integration_tests.rs-101"></a><span class="w">            </span><span class="n">verbose</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-102" name="tests-integration/tests/integration_tests.rs-102"></a><span class="w">            </span><span class="n">accept</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-103" name="tests-integration/tests/integration_tests.rs-103"></a><span class="hll"><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-104" name="tests-integration/tests/integration_tests.rs-104"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-105" name="tests-integration/tests/integration_tests.rs-105"></a>
<a id="tests-integration/tests/integration_tests.rs-106" name="tests-integration/tests/integration_tests.rs-106"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">solve_with_sat</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-107" name="tests-integration/tests/integration_tests.rs-107"></a><span class="w">        </span><span class="n">solver_specific_integration_test</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-111" name="tests-integration/tests/integration_tests.rs-111"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">config</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-112" name="tests-integration/tests/integration_tests.rs-112"></a><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Sat</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-113" name="tests-integration/tests/integration_tests.rs-113"></a><span class="w">            </span><span class="n">verbose</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-114" name="tests-integration/tests/integration_tests.rs-114"></a><span class="w">            </span><span class="n">accept</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-115" name="tests-integration/tests/integration_tests.rs-115"></a><span class="hll"><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-116" name="tests-integration/tests/integration_tests.rs-116"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-117" name="tests-integration/tests/integration_tests.rs-117"></a>
<a id="tests-integration/tests/integration_tests.rs-118" name="tests-integration/tests/integration_tests.rs-118"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">solve_with_smt</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-119" name="tests-integration/tests/integration_tests.rs-119"></a><span class="w">        </span><span class="n">solver_specific_integration_test</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-123" name="tests-integration/tests/integration_tests.rs-123"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">config</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-124" name="tests-integration/tests/integration_tests.rs-124"></a><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Smt</span><span class="p">(</span><span class="n">TheoryConfig</span><span class="p">::</span><span class="n">default</span><span class="p">()),</span>
<a id="tests-integration/tests/integration_tests.rs-125" name="tests-integration/tests/integration_tests.rs-125"></a><span class="w">            </span><span class="n">verbose</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-126" name="tests-integration/tests/integration_tests.rs-126"></a><span class="w">            </span><span class="n">accept</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-127" name="tests-integration/tests/integration_tests.rs-127"></a><span class="hll"><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-128" name="tests-integration/tests/integration_tests.rs-128"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-129" name="tests-integration/tests/integration_tests.rs-129"></a>
<a id="tests-integration/tests/integration_tests.rs-130" name="tests-integration/tests/integration_tests.rs-130"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<a id="tests-integration/tests/integration_tests.rs-131" name="tests-integration/tests/integration_tests.rs-131"></a><span class="p">}</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-138" name="tests-integration/tests/integration_tests.rs-138"></a><span class="w">    </span><span class="n">solver</span><span class="p">:</span><span class="w"> </span><span class="nc">SolverFamily</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-139" name="tests-integration/tests/integration_tests.rs-139"></a><span class="w">    </span><span class="n">verbose</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-140" name="tests-integration/tests/integration_tests.rs-140"></a><span class="w">    </span><span class="n">accept</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-141" name="tests-integration/tests/integration_tests.rs-141"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-142" name="tests-integration/tests/integration_tests.rs-142"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-143" name="tests-integration/tests/integration_tests.rs-143"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">as_str</span><span class="p">();</span>
<a id="tests-integration/tests/integration_tests.rs-144" name="tests-integration/tests/integration_tests.rs-144"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-145" name="tests-integration/tests/integration_tests.rs-145"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_scoped_subscriber</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solver_name</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-146" name="tests-integration/tests/integration_tests.rs-146"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-147" name="tests-integration/tests/integration_tests.rs-147"></a><span class="w">    </span><span class="c1">// run tests in sequence not parallel when verbose logging, to ensure the logs are ordered</span>
<a id="tests-integration/tests/integration_tests.rs-148" name="tests-integration/tests/integration_tests.rs-148"></a><span class="w">    </span><span class="c1">// correctly</span>
<a id="tests-integration/tests/integration_tests.rs-149" name="tests-integration/tests/integration_tests.rs-149"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-150" name="tests-integration/tests/integration_tests.rs-150"></a><span class="w">    </span><span class="c1">// also with ACCEPT=true, as the conjure checking seems to get confused when ran too much at</span>
<a id="tests-integration/tests/integration_tests.rs-151" name="tests-integration/tests/integration_tests.rs-151"></a><span class="w">    </span><span class="c1">// once.</span>
<a id="tests-integration/tests/integration_tests.rs-152" name="tests-integration/tests/integration_tests.rs-152"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-153" name="tests-integration/tests/integration_tests.rs-153"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GUARD</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">into_inner</span><span class="p">());</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-153" name="tests-integration/tests/integration_tests.rs-153"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GUARD</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">into_inner</span><span class="p">());</span>
<a id="tests-integration/tests/integration_tests.rs-154" name="tests-integration/tests/integration_tests.rs-154"></a>
<a id="tests-integration/tests/integration_tests.rs-155" name="tests-integration/tests/integration_tests.rs-155"></a><span class="w">        </span><span class="c1">// set the subscriber as default</span>
<a id="tests-integration/tests/integration_tests.rs-156" name="tests-integration/tests/integration_tests.rs-156"></a><span class="w">        </span><span class="n">tracing</span><span class="p">::</span><span class="n">subscriber</span><span class="p">::</span><span class="n">with_default</span><span class="p">(</span><span class="n">subscriber</span><span class="p">,</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-157" name="tests-integration/tests/integration_tests.rs-157"></a><span class="hll"><span class="w">            </span><span class="n">integration_test_inner</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="n">extension</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">solver</span><span class="p">)</span>
</span><a id="tests-integration/tests/integration_tests.rs-158" name="tests-integration/tests/integration_tests.rs-158"></a><span class="w">        </span><span class="p">})</span>
<a id="tests-integration/tests/integration_tests.rs-159" name="tests-integration/tests/integration_tests.rs-159"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-160" name="tests-integration/tests/integration_tests.rs-160"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_scoped_subscriber</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solver_name</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-161" name="tests-integration/tests/integration_tests.rs-161"></a><span class="w">        </span><span class="n">tracing</span><span class="p">::</span><span class="n">subscriber</span><span class="p">::</span><span class="n">with_default</span><span class="p">(</span><span class="n">subscriber</span><span class="p">,</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-214" name="tests-integration/tests/integration_tests.rs-214"></a>
<a id="tests-integration/tests/integration_tests.rs-215" name="tests-integration/tests/integration_tests.rs-215"></a><span class="w">    </span><span class="c1">// File path</span>
<a id="tests-integration/tests/integration_tests.rs-216" name="tests-integration/tests/integration_tests.rs-216"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{essence_base}.{extension}&quot;</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-217" name="tests-integration/tests/integration_tests.rs-217"></a>
<a id="tests-integration/tests/integration_tests.rs-218" name="tests-integration/tests/integration_tests.rs-218"></a><span class="hll"><span class="w">    </span>
</span><a id="tests-integration/tests/integration_tests.rs-219" name="tests-integration/tests/integration_tests.rs-219"></a><span class="w">    </span><span class="c1">// Stage 1a: Parse the model using the selected parser</span>
<a id="tests-integration/tests/integration_tests.rs-220" name="tests-integration/tests/integration_tests.rs-220"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">parsed_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">enable_native_parser</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-221" name="tests-integration/tests/integration_tests.rs-221"></a><span class="w">        </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-222" name="tests-integration/tests/integration_tests.rs-222"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">write</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-223" name="tests-integration/tests/integration_tests.rs-223"></a><span class="w">            </span><span class="n">ctx</span><span class="p">.</span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{essence_base}.{extension}&quot;</span><span class="p">));</span>
<a id="tests-integration/tests/integration_tests.rs-224" name="tests-integration/tests/integration_tests.rs-224"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-225" name="tests-integration/tests/integration_tests.rs-225"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_essence_file_native</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-226" name="tests-integration/tests/integration_tests.rs-226"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-227" name="tests-integration/tests/integration_tests.rs-227"></a><span class="hll"><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Parsed model (native): {model:#?}&quot;</span><span class="p">);</span>
</span><a id="tests-integration/tests/integration_tests.rs-228" name="tests-integration/tests/integration_tests.rs-228"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-229" name="tests-integration/tests/integration_tests.rs-229"></a><span class="w">        </span><span class="n">save_model_json</span><span class="p">(</span><span class="o">&amp;</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parse&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-230" name="tests-integration/tests/integration_tests.rs-230"></a><span class="hll"><span class="w">        </span>
</span><a id="tests-integration/tests/integration_tests.rs-231" name="tests-integration/tests/integration_tests.rs-231"></a><span class="w">        </span><span class="n">model</span>
<a id="tests-integration/tests/integration_tests.rs-232" name="tests-integration/tests/integration_tests.rs-232"></a><span class="w">    </span><span class="c1">// Stage 1b: Parse the model using the legacy parser</span>
<a id="tests-integration/tests/integration_tests.rs-233" name="tests-integration/tests/integration_tests.rs-233"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-234" name="tests-integration/tests/integration_tests.rs-234"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_essence_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-237" name="tests-integration/tests/integration_tests.rs-237"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-238" name="tests-integration/tests/integration_tests.rs-238"></a><span class="w">        </span><span class="n">save_model_json</span><span class="p">(</span><span class="o">&amp;</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parse&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-239" name="tests-integration/tests/integration_tests.rs-239"></a><span class="w">        </span><span class="n">model</span>
<a id="tests-integration/tests/integration_tests.rs-240" name="tests-integration/tests/integration_tests.rs-240"></a><span class="w">    </span><span class="p">};</span>
<a id="tests-integration/tests/integration_tests.rs-241" name="tests-integration/tests/integration_tests.rs-241"></a><span class="hll"><span class="w">    </span><span class="c1">// // Stage 2a: Rewrite the model using the rule engine (run unless explicitly disabled)</span>
</span><a id="tests-integration/tests/integration_tests.rs-242" name="tests-integration/tests/integration_tests.rs-242"></a>
<a id="tests-integration/tests/integration_tests.rs-243" name="tests-integration/tests/integration_tests.rs-243"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">rewritten_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">apply_rewrite_rules</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-244" name="tests-integration/tests/integration_tests.rs-244"></a><span class="w">        </span><span class="c1">// rule set selection based on solver</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-243" name="tests-integration/tests/integration_tests.rs-243"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">rewritten_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">apply_rewrite_rules</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-244" name="tests-integration/tests/integration_tests.rs-244"></a><span class="w">        </span><span class="c1">// rule set selection based on solver</span>
<a id="tests-integration/tests/integration_tests.rs-245" name="tests-integration/tests/integration_tests.rs-245"></a>
<a id="tests-integration/tests/integration_tests.rs-246" name="tests-integration/tests/integration_tests.rs-246"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">extra_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="tests-integration/tests/integration_tests.rs-247" name="tests-integration/tests/integration_tests.rs-247"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-248" name="tests-integration/tests/integration_tests.rs-248"></a><span class="hll"><span class="w">        </span><span class="c1">// TODO (ss504): figure out why this is only here for sat</span>
</span><a id="tests-integration/tests/integration_tests.rs-249" name="tests-integration/tests/integration_tests.rs-249"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">solver_fam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Sat</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-250" name="tests-integration/tests/integration_tests.rs-250"></a><span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">sat_encoding</span><span class="p">.</span><span class="n">as_str</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-251" name="tests-integration/tests/integration_tests.rs-251"></a><span class="w">                </span><span class="s">&quot;log&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extra_rules</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="s">&quot;SAT_Log&quot;</span><span class="p">),</span>
<a id="tests-integration/tests/integration_tests.rs-252" name="tests-integration/tests/integration_tests.rs-252"></a><span class="w">                </span><span class="s">&quot;direct&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extra_rules</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="s">&quot;SAT_Direct&quot;</span><span class="p">),</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-362" name="tests-integration/tests/integration_tests.rs-362"></a><span class="w">            </span><span class="s">&quot;Solutions (&lt;) do not match conjure (&gt;)!&quot;</span>
<a id="tests-integration/tests/integration_tests.rs-363" name="tests-integration/tests/integration_tests.rs-363"></a><span class="w">        </span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-364" name="tests-integration/tests/integration_tests.rs-364"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-365" name="tests-integration/tests/integration_tests.rs-365"></a>
<a id="tests-integration/tests/integration_tests.rs-366" name="tests-integration/tests/integration_tests.rs-366"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-367" name="tests-integration/tests/integration_tests.rs-367"></a><span class="w">    </span><span class="c1">// When ACCEPT=true, copy all generated files to expected</span>
<a id="tests-integration/tests/integration_tests.rs-368" name="tests-integration/tests/integration_tests.rs-368"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-369" name="tests-integration/tests/integration_tests.rs-369"></a><span class="hll"><span class="w">        </span><span class="n">copy_generated_to_expected</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parse&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;serialised.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-370" name="tests-integration/tests/integration_tests.rs-370"></a>
<a id="tests-integration/tests/integration_tests.rs-371" name="tests-integration/tests/integration_tests.rs-371"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">apply_rewrite_rules</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-372" name="tests-integration/tests/integration_tests.rs-372"></a><span class="hll"><span class="w">            </span><span class="n">copy_generated_to_expected</span><span class="p">(</span>
</span><a id="tests-integration/tests/integration_tests.rs-373" name="tests-integration/tests/integration_tests.rs-373"></a><span class="hll"><span class="w">                </span><span class="n">path</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-374" name="tests-integration/tests/integration_tests.rs-374"></a><span class="hll"><span class="w">                </span><span class="n">essence_base</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-375" name="tests-integration/tests/integration_tests.rs-375"></a><span class="hll"><span class="w">                </span><span class="s">&quot;rewrite&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-376" name="tests-integration/tests/integration_tests.rs-376"></a><span class="hll"><span class="w">                </span><span class="s">&quot;serialised.json&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-377" name="tests-integration/tests/integration_tests.rs-377"></a><span class="hll"><span class="w">                </span><span class="nb">Some</span><span class="p">(</span><span class="n">solver_fam</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-378" name="tests-integration/tests/integration_tests.rs-378"></a><span class="hll"><span class="w">            </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-379" name="tests-integration/tests/integration_tests.rs-379"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-380" name="tests-integration/tests/integration_tests.rs-380"></a>
<a id="tests-integration/tests/integration_tests.rs-381" name="tests-integration/tests/integration_tests.rs-381"></a><span class="hll"><span class="w">        </span><span class="c1">// Always overwrite these ones. Unlike the rest, we don&#39;t need to selectively do these</span>
</span><a id="tests-integration/tests/integration_tests.rs-382" name="tests-integration/tests/integration_tests.rs-382"></a><span class="w">        </span><span class="c1">// based on the test results, so they don&#39;t get done later.</span>
<a id="tests-integration/tests/integration_tests.rs-383" name="tests-integration/tests/integration_tests.rs-383"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-384" name="tests-integration/tests/integration_tests.rs-384"></a><span class="hll"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">solver_fam</span><span class="w"> </span><span class="p">{</span>
</span><a id="tests-integration/tests/integration_tests.rs-385" name="tests-integration/tests/integration_tests.rs-385"></a><span class="hll"><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Minion</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;minion&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-386" name="tests-integration/tests/integration_tests.rs-386"></a><span class="hll"><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Sat</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;sat&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-387" name="tests-integration/tests/integration_tests.rs-387"></a><span class="hll"><span class="w">            </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Smt</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;smt&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-388" name="tests-integration/tests/integration_tests.rs-388"></a><span class="hll"><span class="w">        </span><span class="p">};</span>
</span><a id="tests-integration/tests/integration_tests.rs-389" name="tests-integration/tests/integration_tests.rs-389"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-390" name="tests-integration/tests/integration_tests.rs-390"></a><span class="hll"><span class="w">        </span><span class="n">copy_generated_to_expected</span><span class="p">(</span>
</span><a id="tests-integration/tests/integration_tests.rs-391" name="tests-integration/tests/integration_tests.rs-391"></a><span class="hll"><span class="w">            </span><span class="n">path</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-392" name="tests-integration/tests/integration_tests.rs-392"></a><span class="hll"><span class="w">            </span><span class="n">essence_base</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-393" name="tests-integration/tests/integration_tests.rs-393"></a><span class="hll"><span class="w">            </span><span class="n">solver_name</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-394" name="tests-integration/tests/integration_tests.rs-394"></a><span class="hll"><span class="w">            </span><span class="s">&quot;solutions.json&quot;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-395" name="tests-integration/tests/integration_tests.rs-395"></a><span class="hll"><span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">solver_fam</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-396" name="tests-integration/tests/integration_tests.rs-396"></a><span class="hll"><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-397" name="tests-integration/tests/integration_tests.rs-397"></a>
<a id="tests-integration/tests/integration_tests.rs-398" name="tests-integration/tests/integration_tests.rs-398"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">validate_rule_traces</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-399" name="tests-integration/tests/integration_tests.rs-399"></a><span class="hll"><span class="w">            </span><span class="n">copy_human_trace_generated_to_expected</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="n">solver_fam</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/integration_tests.rs-400" name="tests-integration/tests/integration_tests.rs-400"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-401" name="tests-integration/tests/integration_tests.rs-401"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-402" name="tests-integration/tests/integration_tests.rs-402"></a>
<a id="tests-integration/tests/integration_tests.rs-403" name="tests-integration/tests/integration_tests.rs-403"></a><span class="w">    </span><span class="c1">// Check Stage 1: Compare parsed model with expected</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-426" name="tests-integration/tests/integration_tests.rs-426"></a><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-427" name="tests-integration/tests/integration_tests.rs-427"></a><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">generated_rewrite</span><span class="p">,</span><span class="w"> </span><span class="n">expected_rewrite</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-428" name="tests-integration/tests/integration_tests.rs-428"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-429" name="tests-integration/tests/integration_tests.rs-429"></a>
<a id="tests-integration/tests/integration_tests.rs-430" name="tests-integration/tests/integration_tests.rs-430"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-431" name="tests-integration/tests/integration_tests.rs-431"></a><span class="w">    </span><span class="c1">// Check Stage 3a (solutions)</span>
<a id="tests-integration/tests/integration_tests.rs-432" name="tests-integration/tests/integration_tests.rs-432"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">solve_with_minion</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-433" name="tests-integration/tests/integration_tests.rs-433"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_solutions_json</span><span class="w"> </span><span class="o">=</span>
<a id="tests-integration/tests/integration_tests.rs-434" name="tests-integration/tests/integration_tests.rs-434"></a><span class="w">            </span><span class="n">read_solutions_json</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;expected&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SolverFamily</span><span class="p">::</span><span class="n">Minion</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-454" name="tests-integration/tests/integration_tests.rs-454"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">username_solutions_json</span><span class="p">,</span><span class="w"> </span><span class="n">expected_solutions_json</span><span class="p">);</span>
<a id="tests-integration/tests/integration_tests.rs-455" name="tests-integration/tests/integration_tests.rs-455"></a><span class="w">        </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-456" name="tests-integration/tests/integration_tests.rs-456"></a><span class="w">    </span><span class="p">}</span>
<a id="tests-integration/tests/integration_tests.rs-457" name="tests-integration/tests/integration_tests.rs-457"></a>
<a id="tests-integration/tests/integration_tests.rs-458" name="tests-integration/tests/integration_tests.rs-458"></a><span class="hll"><span class="w">    </span><span class="c1">// // TODO: Implement rule trace validation for morph</span>
</span><a id="tests-integration/tests/integration_tests.rs-459" name="tests-integration/tests/integration_tests.rs-459"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">validate_rule_traces</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">config</span><span class="p">.</span><span class="n">enable_morph_impl</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-460" name="tests-integration/tests/integration_tests.rs-460"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_human_rule_trace</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;generated&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solver_fam</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-461" name="tests-integration/tests/integration_tests.rs-461"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_human_rule_trace</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">essence_base</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;expected&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solver_fam</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-473" name="tests-integration/tests/integration_tests.rs-473"></a>
<a id="tests-integration/tests/integration_tests.rs-474" name="tests-integration/tests/integration_tests.rs-474"></a><span class="k">fn</span><span class="w"> </span><span class="nf">copy_human_trace_generated_to_expected</span><span class="p">(</span>
<a id="tests-integration/tests/integration_tests.rs-475" name="tests-integration/tests/integration_tests.rs-475"></a><span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-476" name="tests-integration/tests/integration_tests.rs-476"></a><span class="w">    </span><span class="n">test_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-477" name="tests-integration/tests/integration_tests.rs-477"></a><span class="hll"><span class="w">    </span><span class="n">solver</span><span class="p">:</span><span class="w"> </span><span class="nc">SolverFamily</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-478" name="tests-integration/tests/integration_tests.rs-478"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-479" name="tests-integration/tests/integration_tests.rs-479"></a><span class="hll"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">as_str</span><span class="p">();</span>
</span><a id="tests-integration/tests/integration_tests.rs-480" name="tests-integration/tests/integration_tests.rs-480"></a><span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span>
<a id="tests-integration/tests/integration_tests.rs-481" name="tests-integration/tests/integration_tests.rs-481"></a><span class="hll"><span class="w">        </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{solver_name}-{test_name}-generated-rule-trace-human.txt&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-482" name="tests-integration/tests/integration_tests.rs-482"></a><span class="hll"><span class="w">        </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{solver_name}-{test_name}-expected-rule-trace-human.txt&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-483" name="tests-integration/tests/integration_tests.rs-483"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-484" name="tests-integration/tests/integration_tests.rs-484"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<a id="tests-integration/tests/integration_tests.rs-485" name="tests-integration/tests/integration_tests.rs-485"></a><span class="p">}</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/integration_tests.rs-488" name="tests-integration/tests/integration_tests.rs-488"></a><span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-489" name="tests-integration/tests/integration_tests.rs-489"></a><span class="w">    </span><span class="n">test_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-490" name="tests-integration/tests/integration_tests.rs-490"></a><span class="w">    </span><span class="n">stage</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-491" name="tests-integration/tests/integration_tests.rs-491"></a><span class="w">    </span><span class="n">extension</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span>
<a id="tests-integration/tests/integration_tests.rs-492" name="tests-integration/tests/integration_tests.rs-492"></a><span class="hll"><span class="w">    </span><span class="n">solver</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">SolverFamily</span><span class="o">&gt;</span><span class="p">,</span>
</span><a id="tests-integration/tests/integration_tests.rs-493" name="tests-integration/tests/integration_tests.rs-493"></a><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/integration_tests.rs-494" name="tests-integration/tests/integration_tests.rs-494"></a><span class="hll"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">map_or</span><span class="p">(</span><span class="s">&quot;agnostic&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">as_str</span><span class="p">());</span>
</span><a id="tests-integration/tests/integration_tests.rs-495" name="tests-integration/tests/integration_tests.rs-495"></a><span class="hll">
</span><a id="tests-integration/tests/integration_tests.rs-496" name="tests-integration/tests/integration_tests.rs-496"></a><span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span>
<a id="tests-integration/tests/integration_tests.rs-497" name="tests-integration/tests/integration_tests.rs-497"></a><span class="hll"><span class="w">        </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{marker}-{test_name}.generated-{stage}.{extension}&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-498" name="tests-integration/tests/integration_tests.rs-498"></a><span class="hll"><span class="w">        </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/{marker}-{test_name}.expected-{stage}.{extension}&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/integration_tests.rs-499" name="tests-integration/tests/integration_tests.rs-499"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/integration_tests.rs-500" name="tests-integration/tests/integration_tests.rs-500"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<a id="tests-integration/tests/integration_tests.rs-501" name="tests-integration/tests/integration_tests.rs-501"></a><span class="p">}</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">tests-integration/tests/roundtrip_tests.rs</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/roundtrip_tests.rs-104" name="tests-integration/tests/roundtrip_tests.rs-104"></a><span class="w">                </span><span class="n">path</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-105" name="tests-integration/tests/roundtrip_tests.rs-105"></a><span class="w">                </span><span class="n">output_filename</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-106" name="tests-integration/tests/roundtrip_tests.rs-106"></a><span class="w">                </span><span class="s">&quot;parse&quot;</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-107" name="tests-integration/tests/roundtrip_tests.rs-107"></a><span class="w">                </span><span class="nb">None</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-108" name="tests-integration/tests/roundtrip_tests.rs-108"></a><span class="hll"><span class="w">            </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-109" name="tests-integration/tests/roundtrip_tests.rs-109"></a><span class="w">            </span><span class="n">save_essence</span><span class="p">(</span><span class="o">&amp;</span><span class="n">initial_model</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">output_filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;generated&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/roundtrip_tests.rs-110" name="tests-integration/tests/roundtrip_tests.rs-110"></a><span class="hll"><span class="w">            </span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-111" name="tests-integration/tests/roundtrip_tests.rs-111"></a><span class="w">            </span><span class="c1">// When ACCEPT = true, copy over generated to expected</span>
<a id="tests-integration/tests/roundtrip_tests.rs-112" name="tests-integration/tests/roundtrip_tests.rs-112"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/roundtrip_tests.rs-113" name="tests-integration/tests/roundtrip_tests.rs-113"></a><span class="hll">
</span><a id="tests-integration/tests/roundtrip_tests.rs-114" name="tests-integration/tests/roundtrip_tests.rs-114"></a><span class="w">                </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span>
<a id="tests-integration/tests/roundtrip_tests.rs-115" name="tests-integration/tests/roundtrip_tests.rs-115"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.generated-parse.serialised.json&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-116" name="tests-integration/tests/roundtrip_tests.rs-116"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.expected-parse.serialised.json&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-117" name="tests-integration/tests/roundtrip_tests.rs-117"></a><span class="w">                </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/roundtrip_tests.rs-118" name="tests-integration/tests/roundtrip_tests.rs-118"></a><span class="w">                </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span>
<a id="tests-integration/tests/roundtrip_tests.rs-119" name="tests-integration/tests/roundtrip_tests.rs-119"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.generated-essence.essence&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-120" name="tests-integration/tests/roundtrip_tests.rs-120"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.expected-essence.essence&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-121" name="tests-integration/tests/roundtrip_tests.rs-121"></a><span class="w">                </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/roundtrip_tests.rs-122" name="tests-integration/tests/roundtrip_tests.rs-122"></a>
<a id="tests-integration/tests/roundtrip_tests.rs-123" name="tests-integration/tests/roundtrip_tests.rs-123"></a><span class="w">            </span><span class="p">}</span>
<a id="tests-integration/tests/roundtrip_tests.rs-124" name="tests-integration/tests/roundtrip_tests.rs-124"></a><span class="hll"><span class="w">            </span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-125" name="tests-integration/tests/roundtrip_tests.rs-125"></a><span class="w">            </span><span class="c1">// Ensures ACCEPT=true has been run at least once</span>
<a id="tests-integration/tests/roundtrip_tests.rs-126" name="tests-integration/tests/roundtrip_tests.rs-126"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">accept</span>
<a id="tests-integration/tests/roundtrip_tests.rs-127" name="tests-integration/tests/roundtrip_tests.rs-127"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Path</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span>
<a id="tests-integration/tests/roundtrip_tests.rs-128" name="tests-integration/tests/roundtrip_tests.rs-128"></a><span class="w">                </span><span class="s">&quot;{path}/agnostic-{output_filename}.expected-parse.serialised.json&quot;</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/roundtrip_tests.rs-142" name="tests-integration/tests/roundtrip_tests.rs-142"></a><span class="w">                </span><span class="n">output_filename</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-143" name="tests-integration/tests/roundtrip_tests.rs-143"></a><span class="w">                </span><span class="s">&quot;expected&quot;</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-144" name="tests-integration/tests/roundtrip_tests.rs-144"></a><span class="w">                </span><span class="s">&quot;parse&quot;</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-145" name="tests-integration/tests/roundtrip_tests.rs-145"></a><span class="w">                </span><span class="nb">None</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-146" name="tests-integration/tests/roundtrip_tests.rs-146"></a><span class="hll"><span class="w">            </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-147" name="tests-integration/tests/roundtrip_tests.rs-147"></a><span class="hll">
</span><a id="tests-integration/tests/roundtrip_tests.rs-148" name="tests-integration/tests/roundtrip_tests.rs-148"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">generated_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_model_json</span><span class="p">(</span>
<a id="tests-integration/tests/roundtrip_tests.rs-149" name="tests-integration/tests/roundtrip_tests.rs-149"></a><span class="w">                </span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-150" name="tests-integration/tests/roundtrip_tests.rs-150"></a><span class="w">                </span><span class="n">path</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-151" name="tests-integration/tests/roundtrip_tests.rs-151"></a><span class="w">                </span><span class="n">output_filename</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/roundtrip_tests.rs-151" name="tests-integration/tests/roundtrip_tests.rs-151"></a><span class="w">                </span><span class="n">output_filename</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-152" name="tests-integration/tests/roundtrip_tests.rs-152"></a><span class="w">                </span><span class="s">&quot;generated&quot;</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-153" name="tests-integration/tests/roundtrip_tests.rs-153"></a><span class="w">                </span><span class="s">&quot;parse&quot;</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-154" name="tests-integration/tests/roundtrip_tests.rs-154"></a><span class="w">                </span><span class="nb">None</span><span class="p">,</span>
<a id="tests-integration/tests/roundtrip_tests.rs-155" name="tests-integration/tests/roundtrip_tests.rs-155"></a><span class="hll"><span class="w">            </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-156" name="tests-integration/tests/roundtrip_tests.rs-156"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">generated_model</span><span class="p">,</span><span class="w"> </span><span class="n">expected_model</span><span class="p">);</span>
<a id="tests-integration/tests/roundtrip_tests.rs-157" name="tests-integration/tests/roundtrip_tests.rs-157"></a>
<a id="tests-integration/tests/roundtrip_tests.rs-158" name="tests-integration/tests/roundtrip_tests.rs-158"></a><span class="w">            </span><span class="c1">// Compares essence files</span>
<a id="tests-integration/tests/roundtrip_tests.rs-159" name="tests-integration/tests/roundtrip_tests.rs-159"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">expected_essence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">::</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><a id="tests-integration/tests/roundtrip_tests.rs-181" name="tests-integration/tests/roundtrip_tests.rs-181"></a>
<a id="tests-integration/tests/roundtrip_tests.rs-182" name="tests-integration/tests/roundtrip_tests.rs-182"></a><span class="w">            </span><span class="c1">// When ACCEPT = true, copy over generated to expected</span>
<a id="tests-integration/tests/roundtrip_tests.rs-183" name="tests-integration/tests/roundtrip_tests.rs-183"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="p">{</span>
<a id="tests-integration/tests/roundtrip_tests.rs-184" name="tests-integration/tests/roundtrip_tests.rs-184"></a><span class="w">                </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span>
<a id="tests-integration/tests/roundtrip_tests.rs-185" name="tests-integration/tests/roundtrip_tests.rs-185"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.generated-error.txt&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-186" name="tests-integration/tests/roundtrip_tests.rs-186"></a><span class="hll"><span class="w">                    </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{path}/agnostic-{output_filename}.expected-error.txt&quot;</span><span class="p">),</span>
</span><a id="tests-integration/tests/roundtrip_tests.rs-187" name="tests-integration/tests/roundtrip_tests.rs-187"></a><span class="w">                </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a id="tests-integration/tests/roundtrip_tests.rs-188" name="tests-integration/tests/roundtrip_tests.rs-188"></a><span class="w">            </span><span class="p">}</span>
<a id="tests-integration/tests/roundtrip_tests.rs-189" name="tests-integration/tests/roundtrip_tests.rs-189"></a>
<a id="tests-integration/tests/roundtrip_tests.rs-190" name="tests-integration/tests/roundtrip_tests.rs-190"></a><span class="w">            </span><span class="c1">// Ensures ACCEPT=true has been run at least once</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
    </body>
</html>